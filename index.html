<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>E-DocuQuest Portal</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
.hidden-section{display:none}
video{border-radius:12px}
canvas{display:none}
</style>
</head>

<body class="bg-emerald-50 font-sans">

<div class="max-w-2xl mx-auto p-6">

<h1 class="text-3xl font-bold text-center mb-6 text-emerald-700">
E-DocuQuest Portal
</h1>

<form id="requestForm" class="bg-white p-6 rounded-xl shadow space-y-4">
<input id="name" type="text" placeholder="Full Name" class="w-full p-3 border rounded" required>
<input id="email" type="email" placeholder="Email" class="w-full p-3 border rounded" required>

<select id="document" class="w-full p-3 border rounded" required>
<option value="">Select Document</option>
<option>Form 137</option>
<option>Form 138</option>
<option>Certificate of Good Moral</option>
</select>

<button type="submit" class="w-full bg-emerald-600 text-white py-3 rounded font-bold">
Submit Request
</button>
</form>

<div id="requestFeedback" class="mt-6"></div>

<!-- VERIFICATION SECTION -->
<div id="verificationSection" class="hidden-section mt-6 bg-white p-6 rounded-xl shadow space-y-4">

<h2 class="font-bold text-yellow-700 text-lg">Identity Verification</h2>

<!-- GOV ID -->
<div>
<p class="font-bold">Government ID</p>

<input type="file" id="govFile" accept="image/*" capture="environment"
class="w-full p-2 border rounded mb-2">

<button onclick="openCamera('gov')" type="button"
class="bg-blue-500 text-white px-3 py-1 rounded text-sm">
Open Camera
</button>

<video id="govVideo" class="hidden w-full mt-2" autoplay></video>
<button onclick="capturePhoto('gov')" type="button"
class="hidden bg-green-600 text-white px-3 py-1 rounded mt-2"
id="govCaptureBtn">Capture</button>

<img id="govPreview" class="mt-2 w-full rounded">
</div>

<!-- SELFIE -->
<div>
<p class="font-bold">Selfie Photo</p>

<input type="file" id="selfieFile" accept="image/*" capture="user"
class="w-full p-2 border rounded mb-2">

<button onclick="openCamera('selfie')" type="button"
class="bg-blue-500 text-white px-3 py-1 rounded text-sm">
Open Camera
</button>

<video id="selfieVideo" class="hidden w-full mt-2" autoplay></video>
<button onclick="capturePhoto('selfie')" type="button"
class="hidden bg-green-600 text-white px-3 py-1 rounded mt-2"
id="selfieCaptureBtn">Capture</button>

<img id="selfiePreview" class="mt-2 w-full rounded">
</div>

<button onclick="submitVerification()" type="button"
class="w-full bg-yellow-600 text-white py-3 rounded font-bold">
Submit Verification
</button>

<div id="verificationFeedback"></div>
</div>

</div>

<script>
const SCRIPT_URL="YOUR_GOOGLE_SCRIPT_URL_HERE";
let trackingId="";
let govImageBase64="";
let selfieImageBase64="";
let stream;

// REQUEST SUBMIT
document.getElementById("requestForm").addEventListener("submit",async e=>{
e.preventDefault();
trackingId="BNHS-"+Math.floor(10000+Math.random()*90000);

await fetch(SCRIPT_URL,{
method:"POST",
body:JSON.stringify({
action:"submit",
trackingId,
name:name.value,
email:email.value,
document:document.getElementById("document").value,
status:"Pending Verification"
})
});

document.getElementById("requestFeedback").innerHTML=
`<div class="bg-emerald-600 text-white p-4 rounded text-center">
Tracking ID:<br><b>${trackingId}</b>
</div>`;

document.getElementById("verificationSection").classList.remove("hidden-section");
});

// OPEN CAMERA
async function openCamera(type){
const video=document.getElementById(type+"Video");
const captureBtn=document.getElementById(type+"CaptureBtn");

video.classList.remove("hidden");
captureBtn.classList.remove("hidden");

stream=await navigator.mediaDevices.getUserMedia({
video:{facingMode:type==="selfie"?"user":"environment"}
});

video.srcObject=stream;
}

// CAPTURE PHOTO
function capturePhoto(type){
const video=document.getElementById(type+"Video");
const preview=document.getElementById(type+"Preview");
const canvas=document.createElement("canvas");
canvas.width=video.videoWidth;
canvas.height=video.videoHeight;
canvas.getContext("2d").drawImage(video,0,0);
const imageData=canvas.toDataURL("image/jpeg");

preview.src=imageData;

if(type==="gov") govImageBase64=imageData;
else selfieImageBase64=imageData;

stream.getTracks().forEach(track=>track.stop());
video.classList.add("hidden");
document.getElementById(type+"CaptureBtn").classList.add("hidden");
}

// FILE SELECT
document.getElementById("govFile").addEventListener("change",function(){
const reader=new FileReader();
reader.onload=e=>{
govImageBase64=e.target.result;
document.getElementById("govPreview").src=e.target.result;
};
reader.readAsDataURL(this.files[0]);
});

document.getElementById("selfieFile").addEventListener("change",function(){
const reader=new FileReader();
reader.onload=e=>{
selfieImageBase64=e.target.result;
document.getElementById("selfiePreview").src=e.target.result;
};
reader.readAsDataURL(this.files[0]);
});

// SUBMIT VERIFICATION
async function submitVerification(){
if(!govImageBase64||!selfieImageBase64){
alert("Please provide both Government ID and Selfie.");
return;
}

await fetch(SCRIPT_URL,{
method:"POST",
body:JSON.stringify({
action:"uploadVerification",
trackingId,
govId:govImageBase64,
selfie:selfieImageBase64
})
});

document.getElementById("verificationFeedback").innerHTML=
`<div class="bg-yellow-500 text-white p-3 rounded text-center">
Verification Submitted. Await Admin Approval.
</div>`;
}
</script>

</body>
</html>
